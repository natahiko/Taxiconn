function loginUser(){let e=$("#log_pass"),a=$("#log_login").val(),o=e.val(),l=$("#log_type").children("option:selected").val();if(e.val(""),"Оберіть як ви хочете увійти..."===l||""===a||""===o)return alert("Всі поля мають бути заповнені"),!1;const i={login:a,password:o,type:l};$.ajax({url:"/login",type:"post",dataType:"json",contentType:"application/json",success:function(e){e.registered||"clients"!==i.type?(document.cookie="userid="+e.userid,document.cookie="authorised="+l,window.location="/profile"):(document.cookie="unauthorised_userid="+e.userid,document.cookie="unauthorised="+l,window.location="/changepassword")},error:function(){return alert("Перевірте правильність данних та спробуйте ще!"),!1},data:JSON.stringify(i)})}function exit(){document.cookie="userid=null;max-age=-1",document.cookie="authorised=null;max-age=-1",window.location="/"}function renew_car_model(e){let a=$("#select_carproducer").children("option:selected").val(),o=$("#carclassprofile").children("option:selected").val();void 0===o&&(o=$('input[name="car_class"]:checked').val());let l={producer:a,carclass:o,secret_key:"OiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4"},i=$("#select_carmodel");i.empty(),$.ajax({url:"/carmodel",type:"post",dataType:"json",contentType:"application/json",success:function(a){let o=a.res;i.append("<option value='default' class='default_option'>Оберіть марку</option>");for(let e=0;e<o.length;e++)i.append("<option value='"+o[e].id+"'>"+o[e].model+"</option>");$("#select_carmodel option[value="+e+"]").attr("selected",!0)},data:JSON.stringify(l)})}function loadSubmit(){const e=$("#driver_email");let a=$("#driver_login");if([!validateName("#driver_name"),!validateName("#driver_surname"),!validAge("#driver_age"),!validateTel("#driver_tel"),!validSeria("#driver_seria"),!validSeriaNum("#driver_seria_num"),!validPassword("#driver_pass","#driver_pass_conf"),!validSelectors(["#select_category","#select_carproducer","#select_carmodel"]),!validAutoNum("driver_autonum"),!validEmptyAndSetKeyup(e),!validEmptyAndSetKeyup(a)].includes(!0))return event.preventDefault(),!1;let o=a.val();const l=e.val()+$("#select_email").val();let i=$("#driver_seria").val()+$("#driver_seria_num").val(),s=$("#driver_tel"),t=s.val();const n=$("#driver_autonum1").val()+$("#driver_autonum2").val()+$("#driver_autonum3").val();$.ajax({url:"/isAllFree",type:"post",dataType:"json",contentType:"application/json",success:function(){a.addClass("is-valid"),a.removeClass("is-invalid"),$.ajax({url:"/sendmail",type:"post",dataType:"json",contentType:"application/json",accept:"application/json",success:function(a){return!!a.res||(e.addClass("is-invalid"),event.preventDefault(),!1)},data:JSON.stringify({email:l,name:$("#driver_name").val(),surname:$("#driver_surname").val(),age:$("#driver_age").val(),login:o,phone:t,description:$("#driver_desc").val(),licence:i,car_producer:$("#select_carproducer").val(),car_model:$("#select_carmodel").val(),car_year:$("#car_year").val(),password:$("#driver_pass").val(),car_class:$('input[name="car_class"]:checked').val(),autonum:n})})},error:function(o){return o.login&&(a.addClass("is-invalid"),a.removeClass("is-valid")),o.email&&(e.addClass("is-invalid"),e.removeClass("is-valid")),o.phone?(s.addClass("is-invalid"),s.removeClass("is-valid")):alert("Перевірте ваш логін, номер телефону та пошту на унікальність!"),event.preventDefault(),!1},data:JSON.stringify({login:o,number:t,email:l,client:!1})})}function setValues(){let e=document.getElementsByTagName("select");for(let a=0;a<e.length;a++)e[a].addEventListener("change",checkValueSelect),"default"===e[a].value?e[a].style.color="#afb1b4":e[a].style.color="#222222"}function checkValueSelect(){let e=this.value;this.style.color="default"===e?"#afb1b4":"#222222"}function checkLogin(e,a){let o=e.val();if(""===o)return!1;e.keyup(function(){e.removeClass("is-valid"),e.removeClass("is-invalid")}),$.ajax({url:"/isLoginFree",type:"post",dataType:"json",contentType:"application/json",accept:"application/json",success:function(a){a.free?(e.addClass("is-valid"),e.removeClass("is-invalid")):(e.addClass("is-invalid"),e.removeClass("is-valid"))},data:JSON.stringify({login:o,type:a})})}async function checkFreeLoginClient(){let e=$("#profile_login");return e.val()===JSON.parse(sessionStorage.getItem("profile"))?(e.addClass("is-valid"),void e.keyup(function(){e.removeClass("is-valid"),e.removeClass("is-invalid")})):checkLogin(e,"clients")}function checkRegisterFreeLogin(){let e=$("#client_login");return e.keyup(function(){e.removeClass("is-valid"),e.removeClass("is-invalid")}),checkLogin(e,"clients")}async function checkFreeLogin(){let e=$("#driver_login");return void 0===e.val()&&(e=$("#profile_login")).val()===JSON.parse(sessionStorage.getItem("profile")).login?(e.addClass("is-valid"),e.keyup(function(){e.removeClass("is-valid"),e.removeClass("is-invalid")}),!0):checkLogin(e,"drivers")}function changePass(e){const a=$("#old_change_pass"),o=$("#change_pass"),l=$("#change_pass2");let i=a.val(),s=o.val();if(i.length<4)return a.addClass("is-invalid"),a.click(function(){a.removeClass("is-invalid")}),!1;if(!validPassword("#change_pass","#change_pass2"))return!1;const t={old:i,now:s,type:e};$.ajax({url:"/password",type:"put",dataType:"json",contentType:"application/json",success:function(){return $("#profilesection").prepend("<div class='alert alert-success alert-dismissible'><button type='button' class='close' data-dismiss='alert'>&times;</button><strong>Ваш пароль успішно змінено!</strong></div>"),$("#cancelchangepass").click(),a.val(""),o.val(""),l.val(""),!0},error:function(e){return"uncorect old"===e.err?(a.addClass("is-invalid"),a.click(function(){a.removeClass("is-invalid")}),l.val("")):(alert(e.err),l.val("")),!1},data:JSON.stringify(t)})}function showEditingProfile(e){if(e){$(".driver_auto input[type=number]").prop("disabled",!0),$(".driver_auto select").prop("disabled",!0),$(".main_profile_part input").prop("disabled",!0),$("#change_password").prop("disabled",!1),$("#profile_desc").prop("disabled",!0),$("#checkLogin").hide();const e=$("#editprofilebutton");e.show(),e.prop("disabled",!1),$("#saveprofilebutton").hide(),$("#canselprofilebutton").hide(),$("#upload_photo").hide()}else $(".driver_auto input[type=number]").prop("disabled",!1),$(".driver_auto select").prop("disabled",!1),$(".main_profile_part input").prop("disabled",!1),$("#profile_desc").prop("disabled",!1),$("#profile_email").prop("disabled",!0),$("#carnumber").prop("disabled",!0),$("#change_password").prop("disabled",!0),$("#editprofilebutton").hide(),$("#checkLogin").show(),$("#saveprofilebutton").show(),$("#canselprofilebutton").show(),$("#upload_photo").show()}function editClientProfile(){let e={login:$("#profile_login").val(),name:$("#profile_name").val(),surname:$("#profile_surname").val(),age:$("#profile_age").val(),phone:$("#profile_phone").val(),desc:$("#profile_desc").val(),photo_src:$("#photo").attr("src")};sessionStorage.setItem("profile",JSON.stringify(e)),showEditingProfile(!1)}function canselClientChanges(){let e=JSON.parse(sessionStorage.getItem("profile"));$("#profile_login").val(e.login),$("#profile_name").val(e.name),$("#profile_surname").val(e.surname),$("#profile_age").val(e.age),$("#profile_phone").val(e.phone),$("#profile_desc").val(e.desc),$("#photo").attr("src",e.photo_src),showEditingProfile(!0),sessionStorage.removeItem("profile")}function editDriverProfile(){let e={login:$("#profile_login").val(),name:$("#profile_name").val(),surname:$("#profile_surname").val(),age:$("#profile_age").val(),phone:$("#profile_phone").val(),desc:$("#profile_desc").val(),class:$("#carclassprofile").children("option:selected").val(),producer:$("#select_carproducer").children("option:selected").val(),model:$("#select_carmodel").children("option:selected").val(),year:$("#profile_carid").val(),photo_src:$("#photo").attr("src")};console.log(e),sessionStorage.setItem("profile",JSON.stringify(e)),showEditingProfile(!1)}function canselDriverChanges(){let e=JSON.parse(sessionStorage.getItem("profile"));$("#profile_login").val(e.login),$("#profile_name").val(e.name),$("#profile_surname").val(e.surname),$("#profile_age").val(e.age),$("#profile_phone").val(e.phone),$("#profile_desc").val(e.desc),$("#profile_carid").val(e.year),showEditingProfile(!0),$("#carclassprofile").val(e.class),$("#select_carproducer").val(e.producer),$("#photo").attr("src",e.photo_src),renew_car_model(e.model),sessionStorage.removeItem("profile")}function cancelClientChanges(){let e=JSON.parse(sessionStorage.getItem("profile"));$("#profile_login").val(e.login),$("#profile_name").val(e.name),$("#profile_surname").val(e.surname),$("#profile_age").val(e.age),$("#profile_phone").val(e.phone),$("#profile_desc").val(e.desc),showEditingProfile(!0),sessionStorage.removeItem("profile")}function saveDriverChanges(){const e={login:$("#profile_login").val(),name:$("#profile_name").val(),surname:$("#profile_surname").val(),age:$("#profile_age").val(),phone:$("#profile_phone").val(),desc:$("#profile_desc").val(),class:$("#carclassprofile").children("option:selected").val(),producer:$("#select_carproducer").children("option:selected").val(),model:$("#select_carmodel").children("option:selected").val(),year:$("#profile_carid").val()};$.ajax({url:"/profile",type:"put",contentType:"application/json",accept:"*/*",success:function(){showEditingProfile(!0),sessionStorage.removeItem("profile")},error:function(){canselDriverChanges(),alert("<b>На сервері виникла якась помилка. Ваші дані не було змінено!</b><br/><span>Можливо номер телефону який ви намагалися вказати вже вказаний у іншого водія</span>"),sessionStorage.removeItem("profile")},data:JSON.stringify(e)})}function saveClientChanges(){const e={login:$("#profile_login").val(),name:$("#profile_name").val(),surname:$("#profile_surname").val(),age:$("#profile_age").val(),phone:$("#profile_phone").val(),desc:$("#profile_desc").val()};$.ajax({url:"/profile",type:"put",dataType:"json",contentType:"application/json",success:function(){showEditingProfile(!0),sessionStorage.removeItem("profile")},error:function(){cancelClientChanges(),console.log("На сервері виникла якась помилка. Ваші дані не було змінено"),sessionStorage.removeItem("profile")},data:JSON.stringify(e)})}function ordertaxi(){const e=$("#address_from").val(),a=$("#address_to").val();if(""===a||""===e)return void alert("Всі поля мають бути заповнені!");const o={address_from:e,address_to:a,pay_type:$("#pay_type").val(),clas:$("input[name='class']:checked").val(),notes:$("#notes").val(),price:$("#km_val").val()};$.ajax({url:"/orders/createorder",type:"post",dataType:"json",contentType:"application/json",success:function(e){e.too_much?$("#foralert").prepend("<div class='alert alert-danger alert-dismissible'><button type='button' class='close' data-dismiss='alert'>&times;</button><strong>Перевищено ліміт!</strong> Ви вже маєте "+e.count+" активні (незавершені) поїздки. Для нового замовлення спершу завершіть або скасуйте їх. </div>"):window.location="/thankspage"},error:function(e){$("#foralert").prepend("<div class='alert alert-danger alert-dismissible'><button type='button' class='close' data-dismiss='alert'>&times;</button><strong>Помилка!</strong> Чомусь не вдалося обробити вашу заявку. <a href='#' onclick='ordertaxi()'>Спробуйте ще!</a></div>"),console.log(e.err)},data:JSON.stringify(o)})}function getOrder(e){$.ajax({url:"/acceptOrder",type:"post",success:function(){window.location="/orders/my"},error:function(){$("#order_modal_alert").modal("toggle")},data:{orderid:e}})}async function renew_orders_method(){$.ajax({url:"/orders/all",type:"get",dataType:"json",contentType:"application/json",success:function(e){$("#orders").html(e.data)},error:function(e){console.log(e.err)}})}function setFooter(){$.ajax({url:"/getfooter",type:"get",dataType:"text",contentType:"text",success:function(e){$("#for_footer").html(e)},error:function(e){console.log(e.err)}})}function sendNewProfilePhoto(){var e=new FormData($("#upload_photo")[0]);$.ajax({url:"/upload_user_photo",type:"POST",data:e,success:function(e){console.log(e),e.empty||document.getElementById("photo").setAttribute("src",e.src)},error:function(){alert("Sorry something happened on server")},contentType:!1,processData:!1})}function endDrive(e){$.ajax({url:"/orders/endDrive",type:"post",dataType:"json",contentType:"application/json",success:function(){window.location="/orders/my"},data:JSON.stringify({order_id:e})})}function cancelDrive(e){$.ajax({url:"/orders/cancelDrive",type:"post",dataType:"json",contentType:"application/json",success:function(){window.location="/orders/my"},data:JSON.stringify({order_id:e})})}function showRegisterModal(){$("#register").modal("toggle"),$("#login").modal("toggle")}function firstChangePass(){validPassword("#new_pass","#new_pass2")&&$.ajax({url:"/changepass",type:"post",dataType:"json",contentType:"application/json",success:function(e){e.data?(document.cookie="unauthorised_userid=null;max-age=-1",document.cookie="unauthorised=null;max-age=-1",window.location="/aboutus"):($("#uncorrect_alert").style("display","block"),$("#new_pass2").val(""),$("#old_pass").val(""))},data:JSON.stringify({old_pass:$("#old_pass").val(),new_pass:$("#new_pass").val()})})}function registerUser(){const e=$("#client_email");let a=$("#client_login");const o=[!validateName("#client_name"),!validateName("#client_surname"),!validAge("#client_age"),!validateTel("#client_tel"),!validEmptyAndSetKeyup(e),!validEmptyAndSetKeyup(a)];if(console.log(o),o.includes(!0))return event.preventDefault(),!1;let l=a.val();const i=e.val()+$("#select_email").val();let s=$("#client_tel"),t=s.val();$.ajax({url:"/isAllFree",type:"post",dataType:"json",contentType:"application/json",success:function(){a.addClass("is-valid"),a.removeClass("is-invalid")},error:function(o){return o.login&&(a.addClass("is-invalid"),a.removeClass("is-valid")),o.email&&(e.addClass("is-invalid"),e.removeClass("is-valid")),o.phone?(s.addClass("is-invalid"),s.removeClass("is-valid")):alert("Перевірте ваш логін, номер телефону та пошту на унікальність!"),event.preventDefault(),!1},data:JSON.stringify({login:l,number:t,email:i,client:!0})})}function calcPrice(){const e=sessionStorage.getItem("distance");null!==e&&$.ajax({url:"/orders/calcprice",type:"post",dataType:"json",contentType:"application/json",success:function(e){document.getElementById("km_val").value=e.price+" грн."},data:JSON.stringify({km:e,pay_type:$("#pay_type").val(),clas:$("input[name='class']:checked").val()})})}